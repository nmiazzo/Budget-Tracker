<div class="subscriptions-view">
  <h3 class="section-title">Active Subscriptions</h3>

  @if (budget.activeSubscriptions().length === 0) {
    <div class="empty-state">No active subscriptions</div>
  }

  <div class="sub-list">
    @for (sub of budget.subscriptions(); track sub.id) {
      <div class="sub-card" [class.inactive]="!sub.active">
        <div class="sub-left">
          @if (getTemplateIcon(sub.templateId)) {
            @if (budget.isIconClass(getTemplateIcon(sub.templateId))) {
              <i [class]="getTemplateIcon(sub.templateId)" class="sub-fa-icon"></i>
            } @else {
              <img [src]="'icons/subscriptions/' + getTemplateIcon(sub.templateId)" width="28" height="28" [alt]="getTemplateName(sub.templateId)">
            }
          } @else {
            <div class="sub-icon-placeholder">
              {{ getTemplateName(sub.templateId).charAt(0) }}
            </div>
          }
          <div>
            <span class="sub-name">{{ getTemplateName(sub.templateId) }}</span>
            <span class="sub-detail">Every {{ sub.intervalDays }} days &middot; Since {{ formatDate(sub.startDate) }}</span>
          </div>
        </div>
        <div class="sub-right">
          <span class="sub-amount">{{ formatCurrency(sub.amount) }}</span>
          <div class="sub-actions">
            <button class="action-btn" (click)="budget.toggleSubscription(sub.id)">
              {{ sub.active ? 'Pause' : 'Resume' }}
            </button>
            <button class="action-btn delete" (click)="budget.removeSubscription(sub.id)">Delete</button>
          </div>
        </div>
      </div>
    }
  </div>

  <!-- Add Subscription -->
  @if (!showForm()) {
    <h3 class="section-title" style="margin-top: 24px">Add Subscription</h3>
    <div class="template-grid">
      @for (t of budget.subscriptionTemplates; track t.id) {
        <button class="template-btn" (click)="selectTemplate(t.id)">
          @if (t.icon) {
            @if (budget.isIconClass(t.icon)) {
              <i [class]="t.icon" class="template-fa-icon"></i>
            } @else {
              <img [src]="'icons/subscriptions/' + t.icon" width="28" height="28" [alt]="t.name">
            }
          } @else {
            <div class="template-icon-placeholder">{{ t.name.charAt(0) }}</div>
          }
          <span class="template-name">{{ t.name }}</span>
          @if (t.defaultAmount) {
            <span class="template-price">{{ formatCurrency(t.defaultAmount) }}</span>
          }
        </button>
      }
    </div>
  }

  @if (showForm()) {
    <div class="sub-form">
      <h3 class="section-title">New Subscription</h3>
      <div class="form-group">
        <label>Amount (&euro;)</label>
        <input type="number" [(ngModel)]="amount" min="0.01" step="0.01">
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Start Date</label>
          <input type="date" [(ngModel)]="startDate">
        </div>
        <div class="form-group">
          <label>Every (days)</label>
          <input type="number" [(ngModel)]="intervalDays" min="1">
        </div>
      </div>
      <div class="form-actions">
        <button class="btn-cancel" (click)="resetForm()">Cancel</button>
        <button class="btn-save" (click)="save()" [disabled]="amount <= 0">Add Subscription</button>
      </div>
    </div>
  }
</div>
